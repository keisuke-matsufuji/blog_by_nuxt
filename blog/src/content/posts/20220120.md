---
title: 【GraphQL】クエリで取得するデータの制限をする
description: GraphQLクエリの制限について
created_at: 2022-01-20
updated_at: 2022-01-20
tags: GraphQL,Apollo,JavaScript

top_image: laravel.svg
cover_image: 9
---

## はじめに
GraphQLクライアントからクエリを呼び出す際、取得するデータに制限がない場合

意図しない膨大なデータ量のリクエストや、悪意のある攻撃を受けてしまう危険性があります。

そういった事態を防ぐために、GraphQLサーバー側で対策をすることができます。


## 環境
- GraphQL Server
    - Node.js
    - Express
    - MongoDB
    - Apollo Server
- GraphQL Client
    - React.js
    - Apollo Client

## データの制限
下記のようなスキーマ・クエリを想定します。
```[server/typeDefs.graphql]
type Photo {
    id: ID!
    url: String!
    name: String!
    postedBy: User!
    taggedUsers: [User!]!
    created: DateTime!
}

type User {
    name: String
    avatar: String
    postedPhotos: [Photo!]!
}
```

```[client/query.graphql]
query allPhotos {
    allPhotos(first=99999) {
        name
        url
        postedBy {
            name
            avatar
        }
    }
} 

```

クエリの引数に```first```を追加すると、一つのデータページが返却するデータ件数を指定することができます。
上記のクエリでは、```first```に```99999```を指定しているため、99999のデータ取得が発生してしまいます。


### リゾルバに制限を加える
クエリリゾルバに引数のチェック処理を加えることで、データサイズを制限します
```[server/resolver.js]
allPhots: (root, data, context) {
    if (data.first > 100) {
        throw new Erroe('Only 100 photos can be requested at a time')
    }
}

```
